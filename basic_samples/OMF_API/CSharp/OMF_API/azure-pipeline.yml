variables:
  binpath: /basic_samples/OMF_API/CSharp/OMF_API
  CredFile: appsettings.json
  CredFileLibrary: prod_omf_appsettings.json
  testpath: /basic_samples/OMF_API/CSharp/OMF_API

jobs:      
- job: OMF_APIDotNet

  pool:
    vmImage: 'Ubuntu-16.04'
  steps :

    # Download Secure File
    # Download a secure file to a temporary location on the build or release agent
    - task: DownloadSecureFile@1
      inputs:
        secureFile: $(CredFileLibrary)


    # Copy Files basic_samples\OMF_API\CSharp\OMF_API
    # Copy files from source folder to target folder using match patterns (The match patterns will only match file paths, not folder paths)
    - task: CopyFiles@2
      inputs:
        sourceFolder: $(Agent.TempDirectory)
        contents: $(CredFileLibrary)
        targetFolder: '$(Build.SourcesDirectory)$(binpath)/'
        #cleanTargetFolder: false # Optional  
        overWrite: true # Optional
        #flattenFolders: false # Optional 
      displayName: copy file

    - script: |
        echo $(Agent.JobName)
        mv $(CredFileLibrary) $(CredFile)
      workingDirectory: $(Build.SourcesDirectory)$(binpath)/
      displayName: 'rename config file'     
      
    - script: |
        dotnet restore
        dotnet msbuild -p:HIGHENTROPYVA=true
        dotnet test
      workingDirectory: $(Build.SourcesDirectory)$(testpath)/
      displayName: 'Run Test'
     